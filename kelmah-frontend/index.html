<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kelma</title>
    <link href="https://fonts.googleapis.com/css2?family=Righteous&display=swap" rel="stylesheet">
    <!-- Preload React vendor chunk first -->
    <link rel="modulepreload" href="/assets/vendor_react-DRNSsPOp.js">
    <!-- Critical React fix for import chain -->
    <script>
      (function() {
        'use strict';
        
        // Create comprehensive React implementation
        const ReactImpl = {
          useState: function(initial) { 
            return [initial, function(newVal) { 
              if (typeof newVal === 'function') return newVal(initial);
              return newVal;
            }]; 
          },
          useEffect: function(effect, deps) { 
            if (typeof effect === 'function') {
              try { effect(); } catch(e) {}
            }
          },
          useContext: function(context) { return context ? context.defaultValue : null; },
          useReducer: function(reducer, initial) { 
            return [initial, function(action) { 
              try { return reducer(initial, action); } catch(e) { return initial; }
            }]; 
          },
          useCallback: function(fn, deps) { return fn; },
          useMemo: function(fn, deps) { 
            try { return fn(); } catch(e) { return null; }
          },
          useRef: function(initial) { return { current: initial }; },
          useImperativeHandle: function() {},
          useLayoutEffect: function(effect, deps) {
            if (typeof effect === 'function') {
              try { effect(); } catch(e) {}
            }
          },
          useDebugValue: function() {},
          useSyncExternalStore: function(subscribe, getSnapshot, getServerSnapshot) { 
            try {
              return getSnapshot ? getSnapshot() : (getServerSnapshot ? getServerSnapshot() : null);
            } catch(e) { return null; }
          },
          createElement: function(type, props, ...children) { 
            return { type, props: props || {}, children };
          },
          Fragment: function(props) { return props.children; },
          Component: function() {},
          PureComponent: function() {},
          memo: function(component) { return component; },
          forwardRef: function(render) { return render; },
          createContext: function(defaultValue) { 
            return { 
              Provider: function(props) { return props.children; },
              Consumer: function(props) { return props.children(defaultValue); },
              defaultValue: defaultValue
            };
          },
          lazy: function(fn) { return fn; },
          Suspense: function(props) { return props.children; },
          version: '18.3.1-vercel-fix'
        };

        // Set React in all scopes immediately
        window.React = ReactImpl;
        globalThis.React = ReactImpl;
        if (typeof global !== 'undefined') global.React = ReactImpl;
        
        // Intercept ES6 imports by overriding the module resolution
        const originalImport = window.__vitePreload;
        if (originalImport) {
          window.__vitePreload = function(moduleId, ...args) {
            // If importing React vendor chunk, ensure it exports React correctly
            if (moduleId.includes('vendor_react') || moduleId.includes('react')) {
              console.log('Intercepting React vendor import:', moduleId);
              const promise = originalImport.call(this, moduleId, ...args);
              return promise.then(module => {
                // Ensure the module exports React under all expected names
                if (module && !module.r && !module.default) {
                  module.r = ReactImpl;  // Export as 'r' (what vendor expects)
                  module.R = ReactImpl;  // Export as 'R' 
                  module.default = ReactImpl;
                  console.log('Fixed React vendor exports');
                }
                return module;
              }).catch(err => {
                console.error('React vendor import failed, using fallback:', err);
                // Return fallback React module
                return {
                  r: ReactImpl,
                  R: ReactImpl,
                  default: ReactImpl
                };
              });
            }
            return originalImport.call(this, moduleId, ...args);
          };
        }

        console.log('Critical React import fix loaded');
      })();
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
